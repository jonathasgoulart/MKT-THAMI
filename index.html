<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Artist Marketing - AI-Powered Content Creation</title>
    <meta name="description"
        content="AI-powered marketing assistant for artists - Generate social media posts, emails, and press releases">

    <!-- PWA Meta Tags -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#10b981">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Artist MKT">
    <link rel="apple-touch-icon" href="icons/icon-192.svg">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <!-- PDF.js for PDF text extraction -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Register Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('ServiceWorker registered:', reg.scope))
                    .catch(err => console.log('ServiceWorker registration failed:', err));
            });
        }
    </script>

    <!-- Auth Check - Redirect to login if not authenticated -->
    <script src="supabase.js"></script>
    <script>
        (async function checkAuth() {
            // Wait for Supabase to be ready
            if (typeof supabase === 'undefined' || !isSupabaseConfigured()) {
                console.log('Supabase not configured, skipping auth check');
                return;
            }

            const sb = getSupabase();
            if (!sb) return;

            const { data: { session } } = await sb.auth.getSession();

            if (!session) {
                // Not authenticated - redirect to login
                window.location.href = '/login.html';
            }
        })();
    </script>
</head>

<body>
    <!-- iOS Install Banner -->
    <div class="ios-install-banner" id="ios-install-banner" style="display: none;">
        <div class="ios-install-content">
            <span class="ios-install-icon">ğŸ“²</span>
            <div class="ios-install-text">
                <strong>Instale o App!</strong>
                <span>Toque em <span class="share-icon">â¬†ï¸</span> e selecione "Adicionar Ã  Tela de InÃ­cio"</span>
            </div>
            <button class="ios-install-close" id="ios-install-close" aria-label="Fechar">âœ•</button>
        </div>
    </div>

    <!-- Header -->
    <header class="app-header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo-icon">ğŸ¤</div>
                <div class="logo-text">
                    <h1>Artist Marketing</h1>
                    <span class="subtitle">AI Assistant</span>
                </div>
            </div>
            <nav class="header-nav">
                <button class="nav-btn" data-view="dashboard" aria-label="Dashboard">
                    <span class="icon">ğŸ’¬</span>
                    <span class="label">Chat</span>
                </button>
                <button class="nav-btn" data-view="profile" aria-label="Profile Manager">
                    <span class="icon">ğŸ‘¤</span>
                    <span class="label">Perfil</span>
                </button>
                <button class="nav-btn" data-view="knowledge" aria-label="Briefings">
                    <span class="icon">ğŸ“‹</span>
                    <span class="label">Briefings</span>
                </button>
            </nav>
            <!-- Artist Selector -->
            <div class="artist-selector" id="artist-selector" style="display: none;">
                <div class="artist-dropdown-wrapper">
                    <button class="artist-dropdown-btn" id="artist-dropdown-btn">
                        <span class="artist-icon">ğŸ¤</span>
                        <span class="artist-name" id="current-artist-name">Selecione um artista</span>
                        <span class="dropdown-arrow">â–¼</span>
                    </button>
                    <div class="artist-dropdown-menu" id="artist-dropdown-menu">
                        <div class="artist-list" id="artist-list">
                            <!-- Artists will be populated here -->
                        </div>
                        <hr class="dropdown-divider">
                        <button class="add-artist-btn" id="add-artist-btn">
                            <span>â•</span> Adicionar Artista
                        </button>
                    </div>
                </div>
            </div>
            <!-- User Info -->
            <div class="user-info" id="user-info" style="display: none;">
                <span class="user-email" id="header-user-email"></span>
                <a href="/admin.html" class="admin-link" id="admin-link" style="display: none;">ğŸ”§ Admin</a>
                <button class="logout-btn" id="header-logout-btn" title="Sair">ğŸšª</button>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <main class="app-main">
        <!-- Dashboard/Chat View -->
        <section id="dashboard-view" class="view-section active">
            <div class="chat-dashboard">
                <!-- Platform Selector -->
                <div class="platform-selector">
                    <span class="platform-label">ğŸ¯</span>
                    <select id="platform-select">
                        <option value="instagram">Instagram</option>
                        <option value="twitter">Twitter/X</option>
                        <option value="facebook">Facebook</option>
                        <option value="tiktok">TikTok</option>
                        <option value="youtube">YouTube</option>
                        <option value="email">Email</option>
                        <option value="press">Press Release</option>
                        <option value="all">Multiplataforma</option>
                    </select>
                </div>

                <!-- Chat Messages Area -->
                <div class="chat-messages" id="chat-messages">
                    <!-- Messages will be rendered here -->
                </div>

                <!-- Quick Actions (only shown when empty) -->
                <div class="chat-quick-actions" id="chat-quick-actions">
                    <button class="quick-action-btn" data-prompt="Preciso de um post estratÃ©gico">
                        ğŸ“ Post
                    </button>
                    <button class="quick-action-btn"
                        data-prompt="Vou lanÃ§ar uma mÃºsica nova e preciso de uma estratÃ©gia completa">
                        ğŸš€ LanÃ§amento
                    </button>
                    <button class="quick-action-btn" data-prompt="Preciso divulgar um show">
                        ğŸ¤ Show
                    </button>
                    <button class="quick-action-btn" data-prompt="Me sugira ideias criativas para esta semana">
                        ğŸ’¡ Ideias
                    </button>
                    <button class="quick-action-btn" data-prompt="Quero criar conteÃºdo de bastidores">
                        ğŸ¬ Bastidores
                    </button>
                </div>

                <!-- Chat Input -->
                <div class="chat-input-container">
                    <div class="chat-input-wrapper">
                        <textarea id="chat-input" placeholder="Me conta o que vocÃª quer criar..." rows="1"></textarea>
                        <button class="chat-send-btn" id="chat-send-btn">
                            <span>â¤</span>
                        </button>
                    </div>
                    <div class="chat-options">
                        <button class="refresh-btn-mobile" id="clear-chat-btn" title="Nova conversa">ğŸ”„ Nova
                            conversa</button>
                        <div class="ai-provider-selector">
                            <span class="ai-label">IA:</span>
                            <select id="chat-ai-provider" class="ai-select">
                                <option value="groq">ğŸš€ Groq</option>
                                <option value="gemini">âœ¨ Gemini</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Profile View -->

        <section id="profile-view" class="view-section">
            <div class="profile-container">
                <h2 class="section-title">Gerenciar Perfil do Artista</h2>
                <p class="section-description">Mantenha as informaÃ§Ãµes atualizadas para gerar conteÃºdo mais relevante e
                    personalizado.</p>

                <div class="profile-tabs">
                    <button class="tab-btn active" data-tab="bio">Biografia</button>
                    <button class="tab-btn" data-tab="achievements">Conquistas</button>
                    <button class="tab-btn" data-tab="events">Eventos</button>
                    <button class="tab-btn" data-tab="releases">LanÃ§amentos</button>
                    <button class="tab-btn" data-tab="social">Redes Sociais</button>
                </div>

                <div class="profile-content">
                    <div id="profile-form">
                        <!-- Profile form will be dynamically generated -->
                    </div>
                    <div class="profile-actions">
                        <button class="btn-secondary" id="reset-profile-btn">Restaurar PadrÃ£o</button>
                        <button class="btn-primary" id="save-profile-btn">Salvar AlteraÃ§Ãµes</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Briefings View -->
        <section id="knowledge-view" class="view-section">
            <div class="knowledge-container">
                <div class="knowledge-header">
                    <div>
                        <h2 class="section-title">ğŸ“‹ Briefings</h2>
                        <p class="section-description">Cadastre briefings, estratÃ©gias e informaÃ§Ãµes da sua carreira.
                            Quanto mais detalhes, mais personalizado serÃ¡ o conteÃºdo gerado.</p>
                    </div>
                    <button class="btn-primary" id="add-knowledge-btn">
                        <span>+</span> Adicionar Briefing
                    </button>
                </div>

                <!-- Add/Edit Form -->
                <div class="knowledge-form-container" id="knowledge-form-container" style="display: none;">
                    <div class="settings-card">
                        <h3 id="knowledge-form-title">Novo Documento</h3>
                        <div class="form-group">
                            <label for="knowledge-title">TÃ­tulo</label>
                            <input type="text" id="knowledge-title" placeholder="Ex: EstratÃ©gia de LanÃ§amento Q1 2025"
                                autocomplete="off" />
                        </div>
                        <div class="form-group">
                            <label for="knowledge-category">Categoria</label>
                            <select id="knowledge-category">
                                <option value="strategy">ğŸ¯ EstratÃ©gia de Marketing</option>
                                <option value="briefing">ğŸ“‹ Briefing de Campanha</option>
                                <option value="voice">ğŸ¤ Tom de Voz</option>
                                <option value="campaign">ğŸ“¢ Campanha Ativa</option>
                                <option value="release">ğŸµ LanÃ§amento</option>
                                <option value="audience">ğŸ‘¥ PÃºblico-Alvo</option>
                                <option value="hashtags">#ï¸âƒ£ Hashtags e Keywords</option>
                                <option value="other">ğŸ“ Outro</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Importar arquivo (opcional)</label>
                            <div class="file-upload-area" id="file-upload-area">
                                <input type="file" id="knowledge-file" accept=".txt,.md,.pdf" hidden />
                                <button type="button" class="btn-secondary file-upload-btn" id="file-upload-btn">
                                    ğŸ“„ Escolher arquivo (.txt, .md, .pdf)
                                </button>
                                <span class="file-name" id="file-name"></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="knowledge-content">ConteÃºdo</label>
                            <textarea id="knowledge-content" rows="8"
                                placeholder="Cole aqui o briefing ou importe um arquivo acima..."></textarea>
                        </div>
                        <div class="form-group" style="flex-direction: row; gap: 10px;">
                            <button class="btn-secondary" id="cancel-knowledge-btn">Cancelar</button>
                            <button class="btn-primary" id="save-knowledge-btn">Salvar Documento</button>
                        </div>
                        <input type="hidden" id="knowledge-edit-id" value="" />
                    </div>
                </div>

                <!-- Search and Filter -->
                <div class="knowledge-controls">
                    <input type="search" id="knowledge-search" placeholder="Buscar documentos..." autocomplete="off"
                        autocorrect="off" autocapitalize="off" spellcheck="false" />
                    <select id="knowledge-filter">
                        <option value="all">Todas as Categorias</option>
                        <option value="strategy">ğŸ¯ EstratÃ©gia</option>
                        <option value="briefing">ğŸ“‹ Briefing</option>
                        <option value="voice">ğŸ¤ Tom de Voz</option>
                        <option value="campaign">ğŸ“¢ Campanha</option>
                        <option value="release">ğŸµ LanÃ§amento</option>
                        <option value="audience">ğŸ‘¥ PÃºblico-Alvo</option>
                        <option value="hashtags">#ï¸âƒ£ Hashtags</option>
                        <option value="other">ğŸ“ Outro</option>
                    </select>
                </div>

                <!-- Stats -->
                <div class="knowledge-stats" id="knowledge-stats">
                    <span>ğŸ“„ 0 documentos</span>
                    <span>ğŸ“ 0 caracteres de contexto</span>
                </div>

                <!-- Documents List -->
                <div id="knowledge-list" class="knowledge-list">
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ¯</div>
                        <p>Nenhuma estratÃ©gia cadastrada ainda</p>
                        <p class="empty-hint">Adicione briefings, estratÃ©gias e conteÃºdos para alimentar a IA</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Settings View -->
        <section id="settings-view" class="view-section">
            <div class="settings-container">
                <h2 class="section-title">âš™ï¸ ConfiguraÃ§Ãµes</h2>
                <p class="section-description">Configure a IA e suas chaves de API</p>

                <!-- AI Provider Selection -->
                <div class="settings-card">
                    <h3>ğŸ¤– Provedor de IA</h3>
                    <p class="settings-hint">Escolha qual IA serÃ¡ usada para gerar conteÃºdo</p>
                    <div class="form-group">
                        <label for="ai-provider-select">Provedor Ativo</label>
                        <select id="ai-provider-select">
                            <option value="groq">ğŸš€ Groq (LLaMA 3) - RÃ¡pido e gratuito</option>
                            <option value="gemini">âœ¨ Gemini (Google) - Alta qualidade</option>
                        </select>
                    </div>
                </div>

                <!-- Groq API Key -->
                <div class="settings-card">
                    <h3>ğŸš€ Groq API Key</h3>
                    <p class="settings-hint">Obtenha sua chave gratuita em <a href="https://console.groq.com"
                            target="_blank">console.groq.com</a></p>
                    <div class="form-group">
                        <label for="groq-api-key-input">Chave de API do Groq</label>
                        <input type="password" id="groq-api-key-input" placeholder="gsk_xxxxxxxxxx...">
                    </div>
                    <div class="settings-actions">
                        <button class="btn-secondary" id="test-groq-btn">ğŸ”— Testar ConexÃ£o</button>
                        <button class="btn-primary" id="save-groq-key-btn">ğŸ’¾ Salvar</button>
                    </div>
                    <div id="groq-status" class="api-status"></div>
                </div>

                <!-- Gemini API Key -->
                <div class="settings-card">
                    <h3>âœ¨ Gemini API Key</h3>
                    <p class="settings-hint">Obtenha sua chave em <a href="https://aistudio.google.com"
                            target="_blank">aistudio.google.com</a></p>
                    <div class="form-group">
                        <label for="api-key-input">Chave de API do Gemini</label>
                        <input type="password" id="api-key-input" placeholder="AIza...">
                    </div>
                    <div class="settings-actions">
                        <button class="btn-secondary" id="test-connection-btn">ğŸ”— Testar ConexÃ£o</button>
                        <button class="btn-primary" id="save-api-key-btn">ğŸ’¾ Salvar</button>
                    </div>
                    <div id="gemini-status" class="api-status"></div>
                </div>
            </div>
        </section>
    </main>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Add Artist Modal -->
    <div class="modal-overlay" id="add-artist-modal" style="display: none;">
        <div class="modal-content">
            <h3>â• Adicionar Novo Artista</h3>
            <div class="form-group">
                <label for="new-artist-name">Nome do Artista *</label>
                <input type="text" id="new-artist-name" placeholder="Ex: JoÃ£o Silva" required>
            </div>
            <div class="form-group">
                <label for="new-artist-genre">GÃªnero Musical</label>
                <input type="text" id="new-artist-genre" placeholder="Ex: Pop, Rock, Sertanejo">
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" id="cancel-add-artist">Cancelar</button>
                <button class="btn-primary" id="confirm-add-artist">Criar Artista</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="error-trap.js"></script>
    <script src="supabase.js"></script>
    <script src="auth.js"></script>
    <script src="data-service.js"></script>
    <script src="thami-profile.js"></script>
    <script src="ai-generator.js"></script>
    <script src="knowledge-base.js"></script>
    <script src="chat-assistant.js"></script>
    <script src="content-manager.js"></script>
    <script src="app.js"></script>

    <!-- iOS Install Banner Script -->
    <script>
        (function () {
            // Check if iOS Safari and not in standalone mode (not installed)
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isInStandalone = window.navigator.standalone === true;
            const isSafari = /Safari/.test(navigator.userAgent) && !/CriOS|FxiOS|OPiOS|EdgiOS/.test(navigator.userAgent);
            const dismissed = localStorage.getItem('ios-install-dismissed');

            // Show banner if: iOS + Safari + not installed + not dismissed recently
            if (isIOS && isSafari && !isInStandalone && !dismissed) {
                const banner = document.getElementById('ios-install-banner');
                const closeBtn = document.getElementById('ios-install-close');

                if (banner && closeBtn) {
                    // Show banner after a short delay
                    setTimeout(() => {
                        banner.style.display = 'block';
                    }, 2000);

                    // Handle close button
                    closeBtn.addEventListener('click', () => {
                        banner.style.display = 'none';
                        // Remember dismissal for 7 days
                        const expiry = Date.now() + (7 * 24 * 60 * 60 * 1000);
                        localStorage.setItem('ios-install-dismissed', expiry.toString());
                    });
                }
            }

            // Clean up expired dismissal
            const dismissedTime = parseInt(localStorage.getItem('ios-install-dismissed') || '0');
            if (dismissedTime && Date.now() > dismissedTime) {
                localStorage.removeItem('ios-install-dismissed');
            }
        })();
    </script>
</body>

</html>